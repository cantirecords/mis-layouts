<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Digital Signage Loader Pro</title>
    <style>
        body, html { margin: 0; padding: 0; background-color: #000; color: white; height: 100%; width: 100%; overflow: hidden; }
        #status { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-family: sans-serif; text-align: center; }
    </style>
</head>
<body>

    <div id="status">Iniciando sistema...</div>
    <div id="app-container"></div>

    <script>
        // 1. TU API DE GOOGLE SHEETS
        const SHEET_API_URL = "https://script.google.com/macros/s/AKfycbxN3pLKuMS0IT2okn66PJw1HQmI_OfSS7WXYXrIyr794a07TX82z_H3Z-SrKGBXRtSQ/exec"; 

        async function launchSystem() {
            const status = document.getElementById('status');
            const container = document.getElementById('app-container');

            try {
                // 2. Obtener el cliente de la URL (?client=wiemar)
                const urlParams = new URLSearchParams(window.location.search);
                const clientId = urlParams.get('client');
                if (!clientId) throw new Error("Falta el parámetro ?client=");

                status.innerText = "Sincronizando con Google Sheets...";

                // 3. Consultar la URL en el Sheet
                const response = await fetch(SHEET_API_URL);
                const data = await response.json();
                const config = data.find(item => item.client_id && item.client_id.toLowerCase() === clientId.toLowerCase());

                if (!config || !config.layout_url) throw new Error("Cliente no encontrado");

                status.innerText = "Descargando contenido de GitHub...";

                // --- EL TRUCO MAGICO ---
                // En lugar de un iframe, descargamos el código HTML puro del layout
                const layoutResponse = await fetch(config.layout_url);
                const htmlCode = await layoutResponse.text();

                // Limpiamos la pantalla e inyectamos el código
                document.open();
                document.write(htmlCode);
                document.close();
                // -----------------------

            } catch (error) {
                status.innerText = "Error: " + error.message;
                status.style.color = "red";
            }
        }

        launchSystem();
    </script>
</body>
</html>
